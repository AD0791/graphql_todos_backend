<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" font-family="Arial, sans-serif">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0288d1"/>
    </marker>
    <marker id="diamond" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto">
      <polygon points="6 0, 12 6, 6 12, 0 6" fill="white" stroke="#0288d1" stroke-width="1"/>
    </marker>
    <marker id="triangle" markerWidth="12" markerHeight="12" refX="6" refY="10" orient="auto">
      <polygon points="0 12, 6 0, 12 12" fill="white" stroke="#0288d1" stroke-width="1"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="900" fill="#fafafa"/>
  
  <!-- Title -->
  <text x="600" y="35" text-anchor="middle" font-size="20" font-weight="bold" fill="#01579b">User Management System - Class Diagram (Task 2.1)</text>
  
  <!-- UserRole Enum Box -->
  <g transform="translate(50, 60)">
    <rect width="280" height="140" rx="5" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
    <rect width="280" height="30" rx="5" fill="#ff9800"/>
    <text x="140" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">«enumeration» UserRole</text>
    <line x1="0" y1="70" x2="280" y2="70" stroke="#ff9800" stroke-width="1"/>
    <text x="10" y="50" font-size="11" fill="#333">USER = "user"</text>
    <text x="10" y="65" font-size="11" fill="#333">ADMIN = "admin"</text>
    <text x="10" y="80" font-size="11" fill="#e65100" font-style="italic">SUPERADMIN = "superadmin"</text>
    <text x="10" y="105" font-size="11" fill="#333">+ can_manage(other: UserRole): bool</text>
    <text x="10" y="125" font-size="10" fill="#666" font-style="italic">Permission: USER=1, ADMIN=2, SUPER=3</text>
  </g>
  
  <!-- TimestampMixin Box -->
  <g transform="translate(400, 60)">
    <rect width="280" height="130" rx="5" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
    <rect width="280" height="30" rx="5" fill="#4caf50"/>
    <text x="140" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">«mixin» TimestampMixin</text>
    <line x1="0" y1="30" x2="280" y2="30" stroke="#4caf50" stroke-width="1"/>
    <text x="10" y="50" font-size="11" fill="#333">+ created_at: datetime</text>
    <text x="10" y="67" font-size="11" fill="#333">+ updated_at: datetime</text>
    <text x="10" y="84" font-size="11" fill="#333">+ deleted_at: datetime | None</text>
    <text x="10" y="101" font-size="11" fill="#c62828" font-weight="bold">+ deleted_by_id: int | None  ← NEW</text>
    <text x="10" y="120" font-size="10" fill="#666" font-style="italic">Soft delete tracking for all models</text>
  </g>
  
  <!-- Base Box -->
  <g transform="translate(750, 60)">
    <rect width="200" height="80" rx="5" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <rect width="200" height="30" rx="5" fill="#2196f3"/>
    <text x="100" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">«abstract» Base</text>
    <line x1="0" y1="30" x2="200" y2="30" stroke="#2196f3" stroke-width="1"/>
    <text x="10" y="50" font-size="11" fill="#333">DeclarativeBase</text>
    <text x="10" y="67" font-size="10" fill="#666" font-style="italic">SQLAlchemy ORM base class</text>
  </g>
  
  <!-- BaseModel Box -->
  <g transform="translate(500, 220)">
    <rect width="240" height="100" rx="5" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
    <rect width="240" height="30" rx="5" fill="#2196f3"/>
    <text x="120" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">«abstract» BaseModel</text>
    <line x1="0" y1="30" x2="240" y2="30" stroke="#2196f3" stroke-width="1"/>
    <text x="10" y="50" font-size="11" fill="#333">+ id: int «PK, auto-increment»</text>
    <text x="10" y="70" font-size="10" fill="#666" font-style="italic">Inherits: TimestampMixin</text>
    <text x="10" y="87" font-size="10" fill="#666" font-style="italic">All models extend this class</text>
  </g>
  
  <!-- Inheritance arrows to BaseModel -->
  <line x1="540" y1="190" x2="540" y2="145" stroke="#0288d1" stroke-width="2" stroke-dasharray="5,3"/>
  <polygon points="540,145 535,155 545,155" fill="white" stroke="#0288d1" stroke-width="2"/>
  
  <line x1="620" y1="220" x2="620" y2="195" stroke="#0288d1" stroke-width="2"/>
  <line x1="620" y1="195" x2="850" y2="195" stroke="#0288d1" stroke-width="2"/>
  <line x1="850" y1="195" x2="850" y2="145" stroke="#0288d1" stroke-width="2"/>
  <polygon points="850,145 845,155 855,155" fill="white" stroke="#0288d1" stroke-width="2"/>
  
  <!-- User Box -->
  <g transform="translate(100, 380)">
    <rect width="380" height="340" rx="5" fill="#e1f5fe" stroke="#0288d1" stroke-width="2"/>
    <rect width="380" height="30" rx="5" fill="#0288d1"/>
    <text x="190" y="20" text-anchor="middle" font-size="14" fill="white" font-weight="bold">User</text>
    
    <!-- Attributes section -->
    <line x1="0" y1="30" x2="380" y2="30" stroke="#0288d1" stroke-width="1"/>
    <text x="10" y="50" font-size="11" fill="#333">+ id: int «PK»</text>
    <text x="10" y="67" font-size="11" fill="#333">+ email: str «unique, indexed»</text>
    <text x="10" y="84" font-size="11" fill="#333">+ hashed_password: str</text>
    <text x="10" y="101" font-size="11" fill="#333">+ full_name: str</text>
    <text x="10" y="118" font-size="11" fill="#333">+ role: UserRole «default: USER»</text>
    <text x="10" y="135" font-size="11" fill="#333">+ is_active: bool «default: True»</text>
    <text x="10" y="152" font-size="11" fill="#0d47a1">+ created_by_id: int | None «FK → users.id»</text>
    <text x="10" y="169" font-size="10" fill="#666" font-style="italic">─────── inherited from BaseModel ───────</text>
    <text x="10" y="186" font-size="11" fill="#666">+ created_at, updated_at, deleted_at, deleted_by_id</text>
    
    <!-- Properties section -->
    <line x1="0" y1="195" x2="380" y2="195" stroke="#0288d1" stroke-width="1"/>
    <text x="10" y="213" font-size="11" fill="#6a1b9a">«property» + is_admin: bool</text>
    <text x="10" y="230" font-size="11" fill="#6a1b9a">«property» + is_superadmin: bool</text>
    <text x="10" y="247" font-size="11" fill="#6a1b9a">«property» + todo_count: int</text>
    
    <!-- Methods section -->
    <line x1="0" y1="255" x2="380" y2="255" stroke="#0288d1" stroke-width="1"/>
    <text x="10" y="273" font-size="11" fill="#333">+ can_manage(other: User): bool</text>
    <text x="10" y="290" font-size="11" fill="#333">+ set_password(plain: str): void</text>
    <text x="10" y="307" font-size="11" fill="#333">+ verify_password(plain: str): bool</text>
    <text x="10" y="324" font-size="11" fill="#c62828">+ soft_delete(deleted_by: User): void</text>
    <text x="10" y="341" font-size="11" fill="#333">+ __repr__(): str</text>
  </g>
  
  <!-- UserRoleHistory Box -->
  <g transform="translate(700, 380)">
    <rect width="340" height="260" rx="5" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
    <rect width="340" height="30" rx="5" fill="#e91e63"/>
    <text x="170" y="20" text-anchor="middle" font-size="14" fill="white" font-weight="bold">UserRoleHistory</text>
    
    <!-- Attributes section -->
    <line x1="0" y1="30" x2="340" y2="30" stroke="#e91e63" stroke-width="1"/>
    <text x="10" y="50" font-size="11" fill="#333">+ id: int «PK»</text>
    <text x="10" y="67" font-size="11" fill="#880e4f">+ user_id: int «FK → users.id, indexed»</text>
    <text x="10" y="84" font-size="11" fill="#333">+ old_role: UserRole</text>
    <text x="10" y="101" font-size="11" fill="#333">+ new_role: UserRole</text>
    <text x="10" y="118" font-size="11" fill="#880e4f">+ changed_by_id: int «FK → users.id»</text>
    <text x="10" y="135" font-size="11" fill="#333">+ changed_at: datetime</text>
    <text x="10" y="152" font-size="11" fill="#333">+ reason: str | None</text>
    <text x="10" y="169" font-size="10" fill="#666" font-style="italic">─────── inherited from BaseModel ───────</text>
    <text x="10" y="186" font-size="11" fill="#666">+ created_at, updated_at</text>
    
    <!-- Purpose note -->
    <line x1="0" y1="200" x2="340" y2="200" stroke="#e91e63" stroke-width="1"/>
    <text x="10" y="220" font-size="10" fill="#880e4f" font-style="italic">Tracks WHO changed WHOSE role,</text>
    <text x="10" y="235" font-size="10" fill="#880e4f" font-style="italic">WHEN it happened, and WHY</text>
    <text x="10" y="252" font-size="10" fill="#880e4f" font-style="italic">(with optional reason)</text>
  </g>
  
  <!-- Inheritance arrow from User to BaseModel -->
  <line x1="290" y1="380" x2="290" y2="350" stroke="#0288d1" stroke-width="2"/>
  <line x1="290" y1="350" x2="620" y2="350" stroke="#0288d1" stroke-width="2"/>
  <line x1="620" y1="350" x2="620" y2="325" stroke="#0288d1" stroke-width="2"/>
  <polygon points="620,325 615,335 625,335" fill="white" stroke="#0288d1" stroke-width="2"/>
  
  <!-- Inheritance arrow from UserRoleHistory to BaseModel -->
  <line x1="870" y1="380" x2="870" y2="350" stroke="#0288d1" stroke-width="2"/>
  <line x1="870" y1="350" x2="620" y2="350" stroke="#0288d1" stroke-width="2"/>
  
  <!-- Self-referential arrow for User (created_by) -->
  <path d="M 100 500 C 50 500, 50 600, 100 600" fill="none" stroke="#0288d1" stroke-width="2"/>
  <polygon points="100,600 90,595 90,605" fill="#0288d1"/>
  <text x="30" y="555" font-size="10" fill="#0288d1" font-weight="bold">created_by</text>
  
  <!-- Self-referential arrow for User (deleted_by) -->
  <path d="M 100 620 C 30 620, 30 680, 100 680" fill="none" stroke="#c62828" stroke-width="2"/>
  <polygon points="100,680 90,675 90,685" fill="#c62828"/>
  <text x="20" y="660" font-size="10" fill="#c62828" font-weight="bold">deleted_by</text>
  
  <!-- Relationship: UserRoleHistory → User (user_id) -->
  <line x1="700" y1="450" x2="480" y2="450" stroke="#e91e63" stroke-width="2"/>
  <polygon points="480,450 490,445 490,455" fill="#e91e63"/>
  <text x="550" y="440" font-size="10" fill="#e91e63" font-weight="bold">user_id (N:1)</text>
  
  <!-- Relationship: UserRoleHistory → User (changed_by_id) -->
  <line x1="700" y1="500" x2="550" y2="500" stroke="#e91e63" stroke-width="2" stroke-dasharray="5,3"/>
  <line x1="550" y1="500" x2="550" y2="550" stroke="#e91e63" stroke-width="2" stroke-dasharray="5,3"/>
  <line x1="550" y1="550" x2="480" y2="550" stroke="#e91e63" stroke-width="2" stroke-dasharray="5,3"/>
  <polygon points="480,550 490,545 490,555" fill="#e91e63"/>
  <text x="555" y="535" font-size="10" fill="#e91e63" font-weight="bold">changed_by_id (N:1)</text>
  
  <!-- Uses relationship: User → UserRole -->
  <line x1="200" y1="380" x2="200" y2="200" stroke="#ff9800" stroke-width="2" stroke-dasharray="3,3"/>
  <text x="160" y="290" font-size="10" fill="#ff9800">«uses»</text>
  
  <!-- Uses relationship: UserRoleHistory → UserRole -->
  <line x1="750" y1="380" x2="330" y2="130" stroke="#ff9800" stroke-width="2" stroke-dasharray="3,3"/>
  <text x="500" y="260" font-size="10" fill="#ff9800">«uses»</text>
  
  <!-- Legend -->
  <g transform="translate(750, 700)">
    <rect width="400" height="150" rx="5" fill="white" stroke="#666" stroke-width="1"/>
    <text x="200" y="20" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">Legend</text>
    <line x1="10" y1="30" x2="390" y2="30" stroke="#666"/>
    
    <line x1="20" y1="50" x2="60" y2="50" stroke="#0288d1" stroke-width="2"/>
    <polygon points="60,50 50,45 50,55" fill="white" stroke="#0288d1" stroke-width="2"/>
    <text x="70" y="54" font-size="10" fill="#333">Inheritance</text>
    
    <line x1="200" y1="50" x2="260" y2="50" stroke="#0288d1" stroke-width="2"/>
    <polygon points="260,50 250,45 250,55" fill="#0288d1"/>
    <text x="270" y="54" font-size="10" fill="#333">FK Relationship</text>
    
    <line x1="20" y1="75" x2="60" y2="75" stroke="#ff9800" stroke-width="2" stroke-dasharray="3,3"/>
    <text x="70" y="79" font-size="10" fill="#333">Uses (dependency)</text>
    
    <line x1="200" y1="75" x2="260" y2="75" stroke="#e91e63" stroke-width="2" stroke-dasharray="5,3"/>
    <text x="270" y="79" font-size="10" fill="#333">N:1 Relationship</text>
    
    <rect x="20" y="95" width="15" height="15" fill="#e1f5fe" stroke="#0288d1"/>
    <text x="45" y="107" font-size="10" fill="#333">Entity</text>
    
    <rect x="120" y="95" width="15" height="15" fill="#fff3e0" stroke="#ff9800"/>
    <text x="145" y="107" font-size="10" fill="#333">Enum</text>
    
    <rect x="220" y="95" width="15" height="15" fill="#e8f5e9" stroke="#4caf50"/>
    <text x="245" y="107" font-size="10" fill="#333">Mixin</text>
    
    <rect x="320" y="95" width="15" height="15" fill="#fce4ec" stroke="#e91e63"/>
    <text x="345" y="107" font-size="10" fill="#333">History</text>
    
    <text x="20" y="135" font-size="10" fill="#c62828" font-weight="bold">Red text = New/Modified</text>
    <text x="200" y="135" font-size="10" fill="#6a1b9a">Purple text = Computed Property</text>
  </g>
</svg>